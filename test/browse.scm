(let ((lookup '<undefined>)) (let ((properties '<undefined>)) (let ((get '<undefined>)) (let ((put '<undefined>)) (let ((*current-gensym* '<undefined>)) (let ((generate-symbol '<undefined>)) (let ((append-to-tail! '<undefined>)) (let ((tree-copy '<undefined>)) (let ((*rand* '<undefined>)) (let ((init '<undefined>)) (let ((browse-random '<undefined>)) (let ((randomize '<undefined>)) (let ((my-match '<undefined>)) (let ((database '<undefined>)) (let ((browse '<undefined>)) (let ((investigate '<undefined>)) (let ((_$20 (set! lookup (lambda (key table ) (letrec ((loop (lambda (x ) (let ((_p16 (null? x))) (if _p16 #f (let ((pair (car x))) (let ((_p17 (car pair))) (let ((_p18 (eq? _p17 key))) (if _p18 pair (let ((_p19 (cdr x))) (loop _p19))))))))))) (loop table)))))) (let ((_$21 (set! properties '()))) (let ((_$23 (set! get (lambda (key1 key2 ) (let ((x (lookup key1 properties))) (if x (let ((_p22 (cdr x))) (let ((y (lookup key2 _p22))) (if y (cdr y) #f))) #f)))))) (let ((_$31 (set! put (lambda (key1 key2 val ) (let ((x (lookup key1 properties))) (if x (let ((_p24 (cdr x))) (let ((y (lookup key2 _p24))) (if y (set-cdr! y val) (let ((_p25 (cons key2 val))) (let ((_p26 (cdr x))) (let ((_p27 (cons _p25 _p26))) (set-cdr! x _p27))))))) (let ((_p28 (cons key2 val))) (let ((_p29 (list key1 _p28))) (let ((_p30 (cons _p29 properties))) (set! properties _p30)))))))))) (let ((_$32 (set! *current-gensym* 0))) (let ((_$36 (set! generate-symbol (lambda () (let ((_p33 (+ *current-gensym* 1))) (let ((_$34 (set! *current-gensym* _p33))) (let ((_p35 (number->string *current-gensym*))) (string->symbol _p35)))))))) (let ((_$42 (set! append-to-tail! (lambda (x y ) (let ((_p37 (null? x))) (if _p37 y (letrec ((_loop0 (lambda (a b ) (let ((_p38 (null? b))) (if _p38 (let ((_$39 (set-cdr! a y))) x) (let ((_p40 (cdr b))) (_loop0 b _p40))))))) (let ((_p41 (cdr x))) (_loop0 x _p41))))))))) (let ((_$49 (set! tree-copy (lambda (x ) (let ((_p43 (pair? x))) (let ((_p44 (not _p43))) (if _p44 x (let ((_p45 (car x))) (let ((_p46 (tree-copy _p45))) (let ((_p47 (cdr x))) (let ((_p48 (tree-copy _p47))) (cons _p46 _p48)))))))))))) (let ((_$50 (set! *rand* 21))) (let ((_$82 (set! init (lambda (n m npats ipats ) (let ((ipats (tree-copy ipats))) (letrec ((_loop1 (lambda (p ) (let ((_p51 (cdr p))) (let ((_p52 (null? _p51))) (if _p52 (set-cdr! p ipats) (let ((_p53 (cdr p))) (_loop1 _p53)))))))) (let ((_$54 (_loop1 ipats))) (letrec ((_loop2 (lambda (n i name a ) (let ((_p55 (= n 0))) (if _p55 a (let ((_p56 (cons name a))) (let ((_$57 (set! a _p56))) (letrec ((_loop3 (lambda (i ) (let ((_p58 (zero? i))) (if _p58 '<undefined> (let ((_p59 (generate-symbol))) (let ((_$60 (put name _p59 #f))) (let ((_p61 (- i 1))) (_loop3 _p61))))))))) (let ((_$62 (_loop3 i))) (letrec ((_loop4 (lambda (i ipats a ) (let ((_p63 (zero? i))) (if _p63 a (let ((_p64 (car ipats))) (let ((_p65 (cons _p64 a))) (let ((_$66 (set! a _p65))) (let ((_p67 (- i 1))) (let ((_p68 (cdr ipats))) (_loop4 _p67 _p68 a))))))))))) (let ((_p69 (_loop4 npats ipats '()))) (let ((_$70 (put name 'pattern _p69))) (letrec ((_loop5 (lambda (j ) (let ((_p71 (zero? j))) (if _p71 '<undefined> (let ((_p72 (generate-symbol))) (let ((_$73 (put name _p72 #f))) (let ((_p74 (- j 1))) (_loop5 _p74))))))))) (let ((_p75 (- m i))) (let ((_$76 (_loop5 _p75))) (let ((_p77 (- n 1))) (let ((_p78 (zero? i))) (let ((_p79 (if _p78 m (- i 1)))) (let ((_p80 (generate-symbol))) (_loop2 _p77 _p79 _p80 a)))))))))))))))))))) (let ((_p81 (generate-symbol))) (_loop2 n m _p81 '())))))))))) (let ((_$86 (set! browse-random (lambda () (let ((_p83 (* *rand* 17))) (let ((_p84 (remainder _p83 251))) (let ((_$85 (set! *rand* _p84))) *rand*))))))) (let ((_$105 (set! randomize (lambda (l ) (letrec ((_loop6 (lambda (a ) (let ((_p87 (null? l))) (if _p87 a (let ((_p88 (browse-random))) (let ((_p89 (length l))) (let ((n (remainder _p88 _p89))) (let ((_p90 (zero? n))) (let ((_$104 (if _p90 (let ((_p91 (car l))) (let ((_p92 (cons _p91 a))) (let ((_$93 (set! a _p92))) (let ((_p94 (cdr l))) (let ((_$95 (set! l _p94))) l))))) (letrec ((_loop7 (lambda (n x ) (let ((_p96 (= n 1))) (if _p96 (let ((_p97 (cadr x))) (let ((_p98 (cons _p97 a))) (let ((_$99 (set! a _p98))) (let ((_p100 (cddr x))) (let ((_$101 (set-cdr! x _p100))) x))))) (let ((_p102 (- n 1))) (let ((_p103 (cdr x))) (_loop7 _p102 _p103)))))))) (_loop7 n l))))) (_loop6 a))))))))))) (_loop6 '())))))) (let ((_$166 (set! my-match (lambda (pat dat alist ) (let ((_p106 (null? pat))) (if _p106 (null? dat) (let ((_p107 (null? dat))) (if _p107 '() (let ((_p108 (car pat))) (let ((_t8 (eq? _p108 #\?))) (let ((_p111 (if _t8 _t8 (let ((_p109 (car pat))) (let ((_p110 (car dat))) (eq? _p109 _p110)))))) (if _p111 (let ((_p112 (cdr pat))) (let ((_p113 (cdr dat))) (my-match _p112 _p113 alist))) (let ((_p114 (car pat))) (let ((_p115 (eq? _p114 #\*))) (if _p115 (let ((_p116 (cdr pat))) (let ((_t9 (my-match _p116 dat alist))) (if _t9 _t9 (let ((_p117 (cdr pat))) (let ((_p118 (cdr dat))) (let ((_t10 (my-match _p117 _p118 alist))) (if _t10 _t10 (let ((_p119 (cdr dat))) (my-match pat _p119 alist))))))))) (let ((_p120 (car pat))) (let ((_p121 (pair? _p120))) (let ((_p122 (not _p121))) (if _p122 (let ((_p123 (car pat))) (let ((_p124 (symbol->string _p123))) (let ((_p125 (string-ref _p124 0))) (let ((_p126 (eq? _p125 #\?))) (if _p126 (let ((_p127 (car pat))) (let ((val (assq _p127 alist))) (if val (let ((_p128 (cdr val))) (let ((_p129 (cdr pat))) (let ((_p130 (cons _p128 _p129))) (my-match _p130 dat alist)))) (let ((_p131 (cdr pat))) (let ((_p132 (cdr dat))) (let ((_p133 (car pat))) (let ((_p134 (car dat))) (let ((_p135 (cons _p133 _p134))) (let ((_p136 (cons _p135 alist))) (my-match _p131 _p132 _p136)))))))))) (let ((_p137 (car pat))) (let ((_p138 (symbol->string _p137))) (let ((_p139 (string-ref _p138 0))) (let ((_p140 (eq? _p139 *))) (if _p140 (let ((_p141 (car pat))) (let ((val (assq _p141 alist))) (if val (let ((_p142 (cdr val))) (let ((_p143 (cdr pat))) (let ((_p144 (append _p142 _p143))) (my-match _p144 dat alist)))) (letrec ((_loop11 (lambda (l e d ) (let ((_t12 (null? e))) (let ((_p149 (if _t12 _t12 (let ((_p145 (cdr pat))) (let ((_p146 (car pat))) (let ((_p147 (cons _p146 l))) (let ((_p148 (cons _p147 alist))) (my-match _p145 d _p148)))))))) (if _p149 (let ((_p150 (null? e))) (if _p150 #f #t)) (let ((_p151 (null? d))) (let ((_p152 (if _p151 '() (car d)))) (let ((_p153 (cons _p152 '()))) (let ((_p154 (append-to-tail! l _p153))) (let ((_p155 (cdr e))) (let ((_p156 (null? d))) (let ((_p157 (if _p156 '() (cdr d)))) (_loop11 _p154 _p155 _p157)))))))))))))) (let ((_p158 (cons '() dat))) (_loop11 '() _p158 dat)))))) #f)))))))))) (let ((_p159 (car dat))) (let ((_p160 (pair? _p159))) (if _p160 (let ((_p161 (car pat))) (let ((_p162 (car dat))) (let ((_p163 (my-match _p161 _p162 alist))) (if _p163 (let ((_p164 (cdr pat))) (let ((_p165 (cdr dat))) (my-match _p164 _p165 alist))) #f)))) #f))))))))))))))))))))))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (let ((vvv '((a a a b b b b a a a a a b b a a a) (a a b b b b a a (a a) (b b)) (a a a b (b a) b a b a))))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (let ((_p167 (init 100 10 4 vvv)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           (let ((_p168 (randomize _p167))) (let ((_$169 (set! database _p168))) (let ((_$170 (set! browse (lambda (pats ) (investigate database pats))))) (let ((_$184 (set! investigate (lambda (units pats ) (letrec ((_loop13 (lambda (units ) (let ((_p171 (null? units))) (if _p171 '<undefined> (letrec ((_loop14 (lambda (pats ) (let ((_p172 (null? pats))) (if _p172 '<undefined> (letrec ((_loop15 (lambda (p ) (let ((_p173 (null? p))) (if _p173 '<undefined> (let ((_p174 (car pats))) (let ((_p175 (car p))) (let ((_$176 (my-match _p174 _p175 '()))) (let ((_p177 (cdr p))) (_loop15 _p177)))))))))) (let ((_p178 (car units))) (let ((_p179 (get _p178 'pattern))) (let ((_$180 (_loop15 _p179))) (let ((_p181 (cdr pats))) (_loop14 _p181))))))))))) (let ((_$182 (_loop14 pats))) (let ((_p183 (cdr units))) (_loop13 _p183))))))))) (_loop13 units))))))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (let ((xxx '((*a ?b *b ?b a *a a *b *a) (*a *b *b *a (*a) (*b)) (? ? * (b a) * ? ?))))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (browse xxx)))))))))))))))))))))))))))))))))))))
 
 